<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>분리 작업</title>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>

    <!-- script -->
    <script src="static/js/base.js"></script>
    <script src="static/js/separator.js"></script>
    <script src="https://unpkg.com/wavesurfer.js@5.1.0/dist/wavesurfer.js"></script>

    <!-- CSS -->
    <link href="static/css/article_style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
</head>

<body>
    <section class="nav-section">
        <div class="main_div">
            <!--로고-->
            <div>
                <a href="/index.html"><img id="main_logo" src="https://i.postimg.cc/pT24Ghq6/logo.png" alt="로고"></a>
            </div>
            <div class="main_">
                <div class="main_nav">
                    <!--로그인 후 버튼들-->
                    <div class="nav_">
                        <div class="nav_sign" id="logged_in_container">
                            <div class="href_a">

                                <div class="sign_a" id="article_admin">
                                    <a href="separator.html" style="font-weight: 600; color: blueviolet;">음원분리</a>
                                </div>

                                <div class="sign_a" id="article_admin">
                                    <a href="notice.html">방법공유</a>
                                </div>

                                <div class="sign_a" id="article_admin">
                                    <a href="index.html">ai노래자랑</a>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="search_div">
                    <input class="search" type="search" placeholder="search">
                    <button class="search_btn" type="submit">search</button>
                </div>

                <div class="main_in">
                    <!--로그인 전 버튼들-->
                    <div class="nav_in">
                        <div class="nav_sign" id="login_container">
                            <div class="href_in">
                                <div class="sign_a">
                                    <a href="signup.html">회원가입</a>
                                </div>
                                <div class="sign_a">
                                    <a href="login.html">로그인</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--로그인 후 보이는 로그아웃-->
                    <div class="intro">
                        <div class="nav_sign" id="logged_out">
                            <div class="sign_out">
                                <button type="button" onclick="handleLogout()">logout</button>
                            </div>
                        </div>
                        <a href="profile.html">
                            <div id="intro"></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="main-section">
        <!-- 
            작성자 : 이준영
            내용 : 오디오 미리보기 + 추출 활성화
            최초 작성일 : 2023.06.21        
        -->
        <div class="upload-container">
            <div>
                <input type="file" accept="audio/mp3" id="audio-file_input" required>
                <div id="waveform"></div>
                <button id="play-button" disabled><i class="bi bi-play-fill"></i></button>
                <button id="pause-button" disabled><i class="bi bi-pause-fill"></i></button>
                <script>
                    $(document).ready(function () {
                        const waveformContainer = $("#waveform")[0];
                        const audiofileInput = $("#audio-file_input")[0];
                        const playButton = $("#play-button");
                        const pauseButton = $("#pause-button");

                        const wavesurfer = WaveSurfer.create({
                            container: waveformContainer,
                            waveColor: 'rgb(83, 10, 219)',
                            progressColor: 'black',
                            responsive: true,
                            barHeight: 1,
                            cursorWidth: 1,
                            cursorColor: '#ff0000',
                            cursorOpacity: 1,
                            height: 100,
                            normalize: true,
                            partialRender: false,
                            pixelRatio: 1,
                            plugins: [],
                            volume: 0.1
                        });

                        wavesurfer.setVolume(0.1);

                        audiofileInput.addEventListener("change", () => {
                            const files = audiofileInput.files;

                            if (!files || !files[0]) {
                                return;
                            }
                            const file = files[0];
                            const fileSize = file.size / 1024 / 1024;

                            if (fileSize <= 15) {
                                const fileUrl = URL.createObjectURL(file);
                                wavesurfer.load(fileUrl);
                                $('#uploadBtn').prop('disabled', false);
                                $('#play-button').prop('disabled', false);
                                $('#pause-button').prop('disabled', false);
                            } else {
                                alert("파일의 크기는 15MB를 초과할 수 없습니다.");
                                audiofileInput.val("");
                                $('#uploadBtn').prop('disabled', true);
                                $('#play-button').prop('disabled', true);
                                $('#pause-button').prop('disabled', true);
                            }
                        });

                        playButton.on("click", () => {
                            wavesurfer.play();
                        });

                        pauseButton.on("click", () => {
                            wavesurfer.pause();
                        });
                    });
                </script>
            </div>
            <div style="color: gray; font-size: 15px;">mp3 파일만 업로드 가능합니다
            </div>
            <button id="uploadBtn" onclick="separator()" disabled>추출</button>
        </div>
        <div class="separator-container">
            <div id="loadingSpinner" style="display: none;">
                로딩 중...
            </div>
            <div class="vocals-container" style="display: none;">
                <span>vocals</span>
                <audio controls id="vocals-audio" style="display: none;"></audio>
            </div>
            <div class="accompaniment-container" style="display: none;">
                <span>accompaniment</span>
                <audio controls id="accompaniment-audio" style="display: none;"></audio>
            </div>
        </div>
    </section>
    <section class="footer-section">

    </section>
</body>

</html>